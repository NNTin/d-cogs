name: CI

on:
  push:
    branches: [main, master, develop]
  pull_request:
    branches: [main, master, develop]

jobs:
  lint-and-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install linting tools
        run: |
          python -m pip install --upgrade pip
          pip install black flake8 isort

      - name: Run code quality checks
        continue-on-error: true
        run: |
          echo "Running Black formatter check..."
          black --check --diff . || true
          echo "Running isort import sorting check..."
          isort --check-only --diff . || true
          echo "Running flake8 linting..."
          flake8 . || true

  ci-summary:
    uses: nntin/d-flows/.github/workflows/step-summary.yml@v0
    needs: [lint-and-check]
    if: always()
    with:
      title: "CI Summary"
      markdown: |
        ## CI Results
        
        **Lint and Check Job:** ${{ needs['lint-and-check'].result == 'success' && '✅ Passed' || '❌ Failed' }}
        
        **Workflow Details:**
        - **Repository:** ${{ github.repository }}
        - **Branch:** ${{ github.ref_name }}
        - **Commit:** ${{ github.sha }}
        - **Event:** ${{ github.event_name }}
        - **Run ID:** ${{ github.run_id }}
        
        **Links:**
        - [View Workflow Run](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
      overwrite: true